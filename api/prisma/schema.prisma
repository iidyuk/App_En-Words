generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           BigInt          @id @default(autoincrement()) @db.BigInt
  email        String          @unique @db.VarChar(255)
  passwordHash String          @map("password_hash") @db.VarChar(255)
  displayName  String          @map("display_name") @db.VarChar(100)
  isActive     Boolean         @map("is_active") @default(true)
  role         String          @db.VarChar(50) @default("user")
  lastLoginAt  DateTime?       @map("last_login_at") @db.Timestamptz(6)
  createdAt    DateTime        @map("created_at") @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime        @map("updated_at") @default(now()) @updatedAt @db.Timestamptz(6)
  quizAnswers  QuizAnswerLog[]
  wordChecks   UserWordCheck[]

  @@map("users")
}

model WordGroup {
  id        BigInt   @id @default(autoincrement()) @db.BigInt
  name      String   @unique @db.VarChar(100)
  sortOrder Int      @map("sort_order") @default(0)
  createdAt DateTime @map("created_at") @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @map("updated_at") @default(now()) @updatedAt @db.Timestamptz(6)
  words     Word[]

  @@map("word_groups")
}

model Word {
  id           BigInt           @id @default(autoincrement()) @db.BigInt
  wordEn       String           @map("word_en") @unique @db.VarChar(255)
  wordGroupId  BigInt?          @map("word_group_id") @db.BigInt
  createdAt    DateTime         @map("created_at") @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime         @map("updated_at") @default(now()) @updatedAt @db.Timestamptz(6)
  wordGroup    WordGroup?       @relation(fields: [wordGroupId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  quizAnswers  QuizAnswerLog[]
  wordChecks   UserWordCheck[]
  posLinks     WordPartOfSpeech[]
  jpTranslations WordJp[]

  @@map("words")
}

model UserWordCheck {
  id        BigInt   @id @default(autoincrement()) @db.BigInt
  userId    BigInt   @map("user_id") @db.BigInt
  wordId    BigInt   @map("word_id") @db.BigInt
  createdAt DateTime @map("created_at") @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @map("updated_at") @default(now()) @updatedAt @db.Timestamptz(6)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  word      Word     @relation(fields: [wordId], references: [id], onDelete: Cascade)

  @@map("user_word_checks")
}

model QuizAnswerLog {
  id          BigInt   @id @default(autoincrement()) @db.BigInt
  userId      BigInt   @map("user_id") @db.BigInt
  wordId      BigInt   @map("word_id") @db.BigInt
  isCorrect   Boolean  @map("is_correct")
  answeredAt  DateTime @map("answered_at") @default(now()) @db.Timestamptz(6)
  user        User     @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  word        Word     @relation(fields: [wordId], references: [id], onUpdate: Cascade, onDelete: Cascade)

  @@map("quiz_answer_logs")
  @@index([userId])
  @@index([wordId])
}

model PartOfSpeech {
  id        BigInt              @id @default(autoincrement()) @db.BigInt
  code      String              @unique @db.VarChar(50)
  label     String              @db.VarChar(100)
  sortOrder Int                 @map("sort_order") @default(0)
  createdAt DateTime            @map("created_at") @default(now()) @db.Timestamptz(6)
  updatedAt DateTime            @map("updated_at") @default(now()) @updatedAt @db.Timestamptz(6)
  links     WordPartOfSpeech[]

  @@map("parts_of_speech")
}

model WordPartOfSpeech {
  id        BigInt       @id @default(autoincrement()) @db.BigInt
  wordId    BigInt       @map("word_id") @db.BigInt
  posId     BigInt       @map("pos_id") @db.BigInt
  createdAt DateTime     @map("created_at") @default(now()) @db.Timestamptz(6)
  updatedAt DateTime     @map("updated_at") @default(now()) @updatedAt @db.Timestamptz(6)
  word      Word         @relation(fields: [wordId], references: [id], onDelete: Cascade)
  partOfSpeech PartOfSpeech @relation(fields: [posId], references: [id], onDelete: Cascade)

  @@unique([wordId, posId])
  @@index([wordId])
  @@index([posId])
  @@map("word_parts_of_speech")
}

model WordJp {
  id        BigInt   @id @default(autoincrement()) @db.BigInt
  wordId    BigInt   @map("word_id") @db.BigInt
  wordJp    String   @map("word_jp") @db.VarChar(255)
  createdAt DateTime @map("created_at") @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @map("updated_at") @default(now()) @updatedAt @db.Timestamptz(6)
  word      Word     @relation(fields: [wordId], references: [id], onDelete: Cascade)

  @@unique([wordId, wordJp])
  @@index([wordId])
  @@map("word_jps")
}
